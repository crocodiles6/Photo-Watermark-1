# 图片水印桌面应用需求文档

## 1. 项目概述

在现有Java命令行图片水印程序的基础上，开发一个功能丰富的Windows桌面GUI应用，支持多种水印类型、批量处理、实时预览和模板管理等高级功能。

## 2. 功能需求

### 2.1 文件处理

#### 2.1.1 导入图片
- **拖拽支持**：用户可直接拖拽单张或多张图片到应用界面导入
- **文件选择器**：提供文件选择对话框，支持多选图片文件
- **文件夹导入**：支持选择整个文件夹导入其中所有支持格式的图片
- **图片列表显示**：在界面上显示已导入图片的缩略图和文件名，支持列表/网格视图切换
- **文件信息展示**：显示图片的基本信息（尺寸、格式、文件大小等）

#### 2.1.2 支持格式
- **输入格式**：必须支持JPEG, PNG, BMP, TIFF等主流格式
- **透明度支持**：PNG格式必须支持透明通道处理
- **输出格式**：用户可选择输出为JPEG或PNG格式

#### 2.1.3 导出图片
- **输出目录**：用户可指定导出文件夹，默认禁止导出到原文件夹以防止覆盖
- **命名规则**：提供多种文件命名选项
  - 保留原文件名
  - 添加自定义前缀（如wm_）
  - 添加自定义后缀（如_watermarked）
- **图片质量**：JPEG格式提供0-100的质量调节滑块
- **尺寸调整**：导出时可选择按宽度、高度或百分比缩放图片
- **批量导出**：一键导出所有处理后的图片

### 2.2 水印类型

#### 2.2.1 文本水印
- **自定义内容**：用户可输入任意文本内容
- **字体设置**：可选择系统已安装的字体、字号（1-200）、粗体、斜体样式
- **颜色选择**：提供调色板选择字体颜色，支持RGB和十六进制值输入
- **透明度调节**：0-100%的透明度滑块控制
- **样式增强**：支持添加阴影、描边效果，可调节阴影颜色、模糊度和偏移
- **背景框**：可选择为文本添加背景色或半透明背景框

#### 2.2.2 图片水印
- **图片选择**：用户可从本地选择图片作为水印（如Logo）
- **透明度支持**：必须支持带透明通道的PNG图片
- **大小调节**：可按比例或自由调整图片水印大小
- **透明度调节**：0-100%的透明度控制
- **裁剪功能**：可选裁剪水印图片部分区域

### 2.3 水印布局与样式

#### 2.3.1 实时预览
- **主预览窗口**：所有水印调整实时显示效果
- **图片切换**：可点击图片列表切换预览不同的图片
- **放大预览**：支持双击预览窗口放大查看细节
- **对比功能**：提供原图/水印图切换对比视图

#### 2.3.2 位置设置
- **预设位置**：提供九宫格布局（四角、四边中点、中心）一键定位
- **手动拖拽**：支持在预览图上通过鼠标拖拽水印到任意位置
- **精确输入**：提供X、Y坐标输入框进行精确定位
- **边距设置**：可设置水印与图片边缘的最小边距

#### 2.3.3 旋转与变换
- **旋转控制**：提供滑块或输入框，支持0-359度任意角度旋转
- **水平/垂直翻转**：提供水印翻转按钮
- **缩放比例**：可独立调整水印的缩放比例

### 2.4 配置管理

#### 2.4.1 水印模板
- **保存模板**：用户可将当前水印设置（内容、样式、位置等所有参数）保存为模板
- **管理模板**：提供模板列表，支持加载、重命名和删除操作
- **模板预览**：显示模板的缩略图和基本信息
- **自动加载**：程序启动时可选择自动加载上一次关闭时的设置或默认模板

## 3. 非功能需求

### 3.1 性能要求
- **响应时间**：GUI操作响应时间不超过500ms
- **批量处理**：支持同时处理至少100张图片，大文件（>10MB）处理时间不超过10秒
- **内存占用**：程序运行时内存占用不超过500MB

### 3.2 用户体验
- **多语言支持**：默认支持中文界面
- **错误处理**：所有错误操作提供友好提示，不崩溃
- **快捷键**：提供常用功能的键盘快捷键
- **撤销/重做**：支持至少10步的操作历史记录

### 3.3 可靠性
- **自动保存**：用户配置和模板自动保存，防止程序意外关闭数据丢失
- **错误恢复**：处理过程中出现错误时，记录日志并允许继续处理其他图片

## 4. 技术实现计划

### 4.1 技术栈选择
- **GUI框架**：JavaFX（现代化UI，支持CSS样式）
- **图片处理**：保留并扩展现有AWT/ImageIO处理能力
- **EXIF处理**：继续使用Apache Commons Imaging库
- **构建工具**：Maven
- **打包工具**：JPackage（生成Windows可执行文件）

### 4.2 代码架构

1. **核心功能模块**（复用并扩展现有代码）
   - `WatermarkProcessor`：扩展支持图片水印、阴影、描边等高级功能
   - `ExifExtractor`：保留现有功能
   - `InputParser`：扩展为通用配置解析器

2. **新增模块**
   - `com.photowatermark.gui`：GUI相关类
     - `MainApplication`：主应用入口
     - `MainController`：主界面控制器
     - `ImageListView`：图片列表视图组件
     - `WatermarkPreview`：水印预览组件
     - `WatermarkPropertiesPanel`：水印属性面板
     - `TemplateManager`：模板管理类
   - `com.photowatermark.model`：数据模型
     - `ImageData`：图片数据模型
     - `WatermarkConfig`：水印配置模型
     - `Template`：模板模型
   - `com.photowatermark.io`：文件操作
     - `ImageImporter`：图片导入类
     - `ImageExporter`：图片导出类

### 4.3 实现步骤

1. **阶段一：基础GUI构建**
   - 创建JavaFX项目结构
   - 实现主界面布局
   - 开发图片导入和列表显示功能

2. **阶段二：水印功能迁移与扩展**
   - 迁移现有文本水印功能到GUI环境
   - 扩展支持更多水印样式（阴影、描边等）
   - 实现图片水印功能

3. **阶段三：高级功能实现**
   - 开发实时预览功能
   - 实现水印位置调整和拖拽
   - 开发模板管理功能

4. **阶段四：完善与优化**
   - 实现批量处理功能
   - 优化图片处理性能
   - 添加错误处理和用户体验改进
   - 打包为Windows可执行文件

## 5. 验收标准

1. 所有指定的文件格式都能正常导入和处理
2. 水印功能在所有预览图上正确显示
3. 批量处理10张不同格式图片无错误
4. 模板保存和加载功能正常工作
5. 程序在各种错误情况下提供友好提示而不崩溃
6. 生成的Windows可执行文件可以在未安装JDK的环境中运行

## 6. 风险评估

1. **性能风险**：处理大型图片或批量图片可能导致性能问题
   - 缓解措施：实现图片缩放预览、异步处理

2. **兼容性风险**：不同系统字体和图片格式的兼容性问题
   - 缓解措施：完善错误处理，支持降级处理

3. **技术风险**：JavaFX在某些Windows环境可能有兼容性问题
   - 缓解措施：测试不同Windows版本，提供备选方案

## 7. 交付物

1. 完整的Java源代码
2. Windows可执行安装包
3. 用户操作手册
4. 详细的API文档
5. 测试报告